'use strict';
const srvDepen = require('@ebay/service-dependency-ebay');

module.exports = async function(dir = process.cwd(), registry = {}) {
    return new Promise((resolve, reject) => {
        srvDepen(dir, undefined).then((services = new Array()) => {
            for (let i = 0; i < services.length; i++) {
                const s = services[i];
                // Check if service doesn't have hostname and is not found in registry as well
                if (!s.hostname && !registry[s.serviceId]) {
                    reject(new Error(`Service not resolved : ${s.serviceId} for ${s.servicename} in ${s.module}`));
                    return;
                }
            }
            resolve();
        });
    });
};
