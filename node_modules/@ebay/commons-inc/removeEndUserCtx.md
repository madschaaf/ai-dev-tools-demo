# End User Context Removal Guide

This document explains how the `removeEndUserCtx` feature works and the various ways to enable or disable it.

## Overview

The `removeEndUserCtx` feature controls whether end user context information is included in the browser side or not. When configRemoveEndUserCtx (set to `true`) or feature flag is enabled for the application pool, end user context is removed from the response.

## Configuration Methods

The system determines whether to remove end user context using the following methods, in order of priority:

### 1. Force Enable/Disable Override

Set the `forceEnableEndUserCtx` variable to explicitly control the behavior:

- `forceEnableEndUserCtx = true` → End user context is preserved (highest priority)
- `forceEnableEndUserCtx = false` → End user context is removed

### 2. OpenFeature Flag

If the force override is not set, the system checks the OpenFeature flag:

- Feature flag `REMOVE_ENDUSERCTX_HEADER = true` → End user context is removed

To use this method, please contact #nodejs team so that they can allowlist your application pool in feature flag.

### 3. Configuration Setting

If neither of the above are set, the system falls back to the configuration value:

- `configRemoveEndUserCtx = true` → End user context is removed
- `configRemoveEndUserCtx = false` → End user context is preserved

### 4. Default Behavior

If none of the above conditions are met, end user context is preserved (default behavior).

## Implementation Details

The determination is made by the `shouldRemoveEndUserContext(req)` function which returns:
- `true` if the end user context should be removed
- `false` if the end user context should be preserved

This value is then used by the `utils.generateCosHeadersFunction()` to determine what headers to include in client-side responses.
