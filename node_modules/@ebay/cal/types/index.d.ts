import { EventEmitter } from 'events';

declare namespace cal {
    enum Status {
        SUCCESS = '0',
        FATAL = '1',
        ERROR = '2',
        EXCEPTION = '3',
        WARNING = '4'
    }

    enum MessageClass {
        EVENT = 'E',
        TRANSACTION_START = 't',
        TRANSACTION_END = 'T',
        ATOMIC = 'A',
        HEARTBEAT = 'H'
    }

    interface Activity extends EventEmitter {
        messageClass: MessageClass;
        type: string;
        name: string;
        status: Status;
        timestamp: number;
        threadId: number;
        eventId: number;
        parent: Activity;
        parentEventId: number;
        flushBuffer: boolean;

        /**
         * Marks the transaction complete and flushes the event into CAL output stream
         * @param status can be 0 for success and non-0 for failure
         */
        complete(status?: Status): void;
        addData(key: string, data: any): this;
        addData(data: any): this;
    }

    interface Event extends Activity {}

    interface Heartbeat extends Activity {}

    interface Transaction extends Activity {
        duration: number;
        correlationId: string;
        flush(): void;
    }

    function createEvent(type: string, name: string, status?: Status, data?: any): Event;
    function createHeartbeat(type: string, name: string, status?: Status, data?: any): Heartbeat;
    function createTransaction(type: string, name: string, status?: Status, next?: (err: Error, tx: Transaction) => void): Transaction;
    function createTransaction(type: string, name: string, next: (err: Error, tx: Transaction) => void): Transaction;
    function createTransaction(type: string, name: string, status: Status, data: any, next: (err: Error, tx: Transaction) => void): Transaction;
}

export default cal;
