import { Context } from './Context';
import { ServiceContext } from './ServiceContext';
import { WebContext } from './WebContext';

/**
 * This middleware function adds the openfeature client with default provider (AAFF Provider)
 * and exposes to the application through the req.ebay.openfeature object.
 * openfeature-ebay can be used as a module import to achieve the same functionality through
 * the API class. However, future functionality related to pre-fetching feature flag metadata
 * will require using this middleware function.
 * @param req
 * @param res
 * @param config
 * @returns
 */
export function create(req, res, openfeatureGlobalCache) {
    const context: Context = req.ebay.isService
        ? new ServiceContext(req, res, openfeatureGlobalCache)
        : new WebContext(req, res, openfeatureGlobalCache);
    return context;
}
