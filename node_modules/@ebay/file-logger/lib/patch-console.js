/* eslint-disable no-console */
const _log = console.log, _error = console.error, _warn = console.warn, _info = console.info;
const Logger = require('./logger');
const deployEnv = require('@ebay/environment-ebay');

function patchUp() {
    // Skip for Dev & Test
    if (deployEnv.isDev() || deployEnv.isTest()) {
        return;
    }

    const startupLogger = new Logger('startup');

    process.once('vistart', () => {
        console.log('Stopping Startup logs.');
        console.log = _log;
        console.error = _error;
        console.warn = _warn;
        console.info = _info;
    });

    function interceptAndLog(original) {
        return function () {
            startupLogger.log(arguments);
            original.apply(console, arguments);
        };
    }

    console.log = (function (original) {
        return interceptAndLog(original);
    }(console.log));

    console.error = (function (original) {
        return interceptAndLog(original);
    }(console.error));

    console.warn = (function (original) {
        return interceptAndLog(original);
    }(console.warn));

    console.info = (function (original) {
        return interceptAndLog(original);
    }(console.info));

    console.log('Starting Startup logs.');
}

module.exports = patchUp;