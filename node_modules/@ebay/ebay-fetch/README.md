# @ebay/ebay-fetch

## Install

#### Install current version
```sh
$ yarn add @ebay/ebay-fetch
```

## `fetch` Usage

`fetch` provides a `fetch`-like interface and response while still using eBay's service-client and all the instrumentation that provides.

Given this service configuration:

```json
{
    "services": {
        "categoryService": {
            "protocol": "http:",
            "hostname": "catsvc.qa.ebay.com",
            "basepath": "/catalog/v1/category_tree/0",
            "method": "GET",
            "socketTimeout": 5000,
            "headers": {
                "Accept": "application/json",
                "Content-Type": "application/json"
            },
            "oauth": {
                "token": [
                    "app"
                ],
                "scope": [
                    "https://api.ebay.com/oauth/scope/core@application"
                ]
            },
            "instruments": [
                "error-handler"
            ]
        }
    }
}
```

Include:

```js
const { fetch: ebayFetch } = require('@ebay/ebay-fetch');
const serviceName = 'ebay-fetch-test-categoryService';
const res = await ebayFetch(serviceName, context, {
    method: 'GET',
    path: '/category/6001' // Basepath and hostname is provided in service config
});
res.ok // true (or false)
res.status // 200 (any response status code)
res.statusText // Ok (status in text format)
const json = await res.json();
```

Fetch Comparison:

```js
const { fetch: nodeFetch } = require('node-fetch');
const res = await nodeFetch(`http://catsvc.qa.ebay.com/catalog/v1/category_tree/0/category/6001`, {
    method: 'GET'
});
res.ok // true (or false)
res.status // 200 (any response status code)
res.statusText // Ok (status in text format)
const json = await res.json();
```

## `serviceClient` Usage

Include:

```js
const { serviceClient } = require('@ebay/ebay-fetch');

```

### Promise style

Basic example:

```js
serviceClient(serviceName, context, request).then ((jsonResponse) => { // do something });

```

With optional callback:

```js
// Simple callback function
function callback(resolve, reject, error, response) {
    if(error) {
        reject(error);
    } else {
        resolve(response.body);
    }
}
serviceClient(serviceName, context,  request, callback).then ((jsonResponse) => { // do something });
```

### Async/Await style

```js
const jsonResponse = await serviceClient(servicenName, context, request);
```

Parameters:

#### serviceName: the serviceName and configurations will be defined in consuming service config.json. Here is an example:
    
```json    
    "services": {
        "serviceName": {
            "protocol": "https:",
            "hostname": "",
            "basepath": "",
            "socketTimeout": 5000,
            "oauth": true,
            "rejectUnauthorized": false,
            "headers": {
                "Accept": "application/json",
                "Content-Type": "application/json"
            },
            "instruments": [
                "error-handler",
                "retry",
                "config-bean",
                "@ebay/cal"
            ]
        }
    }
```

#### context: ebay Request Context

```ts
    eBayRequestContext {
        ebay?: eBay
        params?: any
        query?: any
        body?: any | string
        secrets?: FideliusSecrets
        method?: string
        path?: string
        ip?: string
    }
```
#### serviceRequest: The specifics of the request you're making to the downstream service

```ts
    ServiceRequest {
        body?: object | string
        headers?: object
        params?: object
        query?: object
        path?: string
        options?: object
        string
    }
```

#### callback: callback function if you need more control over the response

```ts
declare interface ServiceRequestOptionalCallback {
    (resolve: Function, reject: Function, error: object, response: ServiceResponse): void
}
```

Returns:

```html
serviceClient will return promise object, if there is error from downsteam service, an error object
will return, otherwise response object will return
```
