import { Request, Response, Application } from 'express';

export interface CommonModel {
    host: string;
    ipAddress: string;
    cal: string;
    clientIpAddress: string;
    forceXml: boolean;
    envoyEnabled: boolean;
    containerPdlcEnabled: boolean;
    classOfService: string;
}

export type StatusModel = any;

export interface ComponentModel extends CommonModel {
    component: StatusModel;
}

export type Handler = (callback: (statusModel: StatusModel) => StatusModel | undefined) => void;
export type Renderer = (req: Request, componentModel: ComponentModel, res: Response) => void;

export interface ComponentStatus {
    /**
     * Handler used to provide component properties
     */
    handler: Handler;
    /**
     * Optional renderer
     */
    renderer?: Renderer;
    isAsync?: boolean;
    /**
     * Returns component status by component name
     */
    getStatus(componentName: string, callback?: (statusModel: StatusModel) => StatusModel): StatusModel;
    /**
     * Returns an array of component names registered
     */
    getComponents(): string[];

    /**
     * Returns true if component status is async, i.e. requires a callback to get its status
     */
    isStatusAsync(componentName: string): boolean;

    /**
     * Returns component status renderer if available
     */
    getRenderer(componentName: string): Renderer | undefined;

    /**
     * Registers component status
     */
    register(componentName: string, handler: Handler, renderer?: Renderer, isAsync?: boolean): void;
}

/**
 * Registers component status
 */
export function register(componentName: string, handler: Handler, renderer?: Renderer, isAsync?: boolean): void;

/**
 * Exposes component status repository
 */
export const componentStatus: ComponentStatus;

/**
 * Sets up a dedicated ValidateInternals server on port 8083 (or VIPORT env variable).
 * Overrides the parent Express app's listen method to automatically start the VI server
 * when the main app starts, and handles graceful shutdown when the parent app closes.
 * 
 * @param parentApp - The Express application instance to integrate with
 * @returns Promise<void>
 */
export function launchDedicatedVI(parentApp: Application): Promise<void>;
