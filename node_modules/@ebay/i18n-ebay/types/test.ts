/// <reference types="@ebay/commons-ebay" />
import { Request } from 'express';
import { getContentManager, ContentManager, ContentBundle, middleware, use, i18nEbay, t } from '@ebay/i18n-ebay';

(req: Request) => {
  // $ExpectType ContentManager
  req.ebay.i18n;
};

// $ExpectType Middleware
middleware();

// $ExpectError
use().getBundle();

use(module).getBundle('test', (err, bundle) => {
    // $ExpectType ContentBundle
    bundle;
    // $ExpectType ResolvedContent | ResolvedContentMap | ResolvedContent[]
    bundle.get('greetings');
});

// $ExpectType string
t('test', 'greetings', { name: 'Frank' });

(contentManager: ContentManager) => {
    // $ExpectType void
    contentManager.getBundle('MyProject/test', (err, bundle) => {
        // $ExpectType ContentBundle
        bundle;
        // $ExpectType string | null
        bundle.getText('greeting', { name: 'Frank' });

        const someList = bundle.get('someList');
        if (Array.isArray(someList)) {
            // $ExpectType ResolvedContent[]
            someList;
            // $ExpectType string | null
            someList[0].getText({ name: 'Frank' });
        }

        // $ExpectType ResolvedContent | ResolvedContentMap | ResolvedContent[]
        bundle.get('someMap');

        const someMap = bundle.get('someMap');
        // $ExpectType string | null
        (<i18nEbay.ResolvedContentMap> someMap).foo.getText();

        // $ExpectType string | null
        bundle.getText('contentWithLink', {
            myLink: 'http://www.ebay.com',
            followerCount: 20
        });

        // $ExpectType string | null
        bundle.getText('testTarget');
    });
};
