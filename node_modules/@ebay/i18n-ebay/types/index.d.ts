// Internal type definitions for @ebay/i18n-ebay 4.0
// Project: https://github.corp.ebay.com/nodejs/i18n-ebay
// Definitions by: Timur Manyanov <https://github.corp.ebay.com/tmanyanov>
// Definitions: https://github.corp.ebay.com/TypeScript/types-ebay
// TypeScript Version: 3.0

import { Request, Response } from 'express';

export namespace i18nEbay {
    type BundleCallback = (err: null, bundle: ContentBundle) => void;
    type ErrorCallback = (err: Error) => void;
    type RenderContext = object;
    type Middleware = (req: Request, res: Response, next: any) => void;

    interface ResolvedContent {
        get(data?: object): any;
        getText(data?: object): string | null;
        toString(): string | null;
    }

    interface ResolvedContentMap {
        [key: string]: ResolvedContent;
    }
}

export interface ContentBundle {
    get(path?: string, data?: object): i18nEbay.ResolvedContent | i18nEbay.ResolvedContentMap | i18nEbay.ResolvedContent[];
    getText(path?: string, data?: object, context?: object): string | null;
}

export interface ContentManager {
    getBundle(bundle: string, from?: string): ContentBundle;
    getBundle(bundle: string, callback: i18nEbay.BundleCallback | i18nEbay.ErrorCallback): void;
    getBundle(bundle: string, from: string, callback: i18nEbay.BundleCallback | i18nEbay.ErrorCallback): void;
}

export function getContentManager(reqOrRenderContext?: Request | i18nEbay.RenderContext): ContentManager | void;

export function use(nodule?: object): {
    getBundle(bundle: string, callback: i18nEbay.BundleCallback | i18nEbay.ErrorCallback): void;
};

export function middleware(options?: object): i18nEbay.Middleware;

export interface I18nContext {
    formatters?: Record<string, (element: unknown, data: unknown, context: I18nContext) => string>;
    target?: unknown;
    locality?: unknown;
}

export function t(bundle: string, path: string, data?: object, context?: I18nContext): string;

declare module '@ebay/commons-ebay' {
  interface EbayContext {
    i18n: ContentManager;
  }
}
