'use strict';

const Utils = require('@ebay/utils-ebay');
const Urls = require('@ebay/urls-ebay');

module.exports = function formatA(element, data, context) {
    if (element.type === 'URL_EBAY') {
        const urlParts = new URL(element.attributes.href);
        const locality = context.locality;
        const baseHost = Utils.getBaseHost(urlParts.hostname);
        const targetBaseHost = Urls.getBaseUrl(locality && locality.siteId || 0);
        urlParts.hostname = urlParts.hostname.replace(baseHost, targetBaseHost);
        delete urlParts.host;
        const newHref = urlParts.toString();
        if (!element.attributes.href.endsWith('/') && newHref.endsWith('/')) {
            // remove trailing slash
            element.attributes.href = newHref.substring(0, newHref.length - 1);
        }
        else {
            element.attributes.href = newHref;
        }
    }

    return context.renderTag(element, data, context);
};
