const utils = require("./utils");

// The browser needs the raw bundles in a global `$i18n` variable.
// Below we serialize all preloaded bundles to a script that can be executed in the browser.

module.exports = function getPreloadScript(out) {
    const g = out.global;
    const ebay =
        g.platform ||
        (g.request || g.req || out.stream?.req || out.stream?.request)?.ebay;

    const preloaded = ebay?.i18n?.preloaded;
    if (preloaded) {
        const rawBundles = {};
        const target = ebay.i18n.getTarget();
        for (const key in preloaded) {
            rawBundles[key] = utils.copy(preloaded[key]._rawBundle, target);
        }

        return `Object.assign($i18n=window.$i18n||{},${JSON.stringify(
            rawBundles
        )});`;
    }
};
