# locale-ebay 

[![Build Status](https://go/-/nodejsci/job/nodejs/job/locale-ebay/job/master/badge/icon)](https://go/-/nodejsci/job/nodejs/job/locale-ebay/job/master/) [![Dependency Status](https://appvalidator.vip.qa.ebay.com/nodejs/locale-ebay.svg)](https://appvalidator.vip.qa.ebay.com/nodejs/locale-ebay)
[![Code Coverage](https://badgeme.vip.qa.ebay.com/badge/sonar/v0/coverage/locale-ebay)](http://sonar/dashboard/index?id=locale-ebay)


node locale for ebay


## Changelog

See   [CHANGELOG.MD](https://github.corp.ebay.com/nodejs/locale-ebay/blob/master/CHANGELOG.md#changelog)

### Locale

 - For testing locale in your app, use `_ul` queryparam
  `http://localhost.ebay.com:8080/?_ul=DEde-DE&siteoverride=77`
   Use `_ul` for GBH, `siteoverride` for Non-GBH countries

### Locality Object

**req.locality** holds the reference of resolved country, language, timezone, directionality and other geo data.

```javascript
    //For server side
    req.locality = {
        country  : '2 letter country-code',                           // US (default)
        countryId: 'countryId',                                       // 1
        isGeoCountry: 'boolean value, if is geo country',             // false
        language : '2 letter language code e.g. en, fr, es',          // en
        locale  : '5 letter language-code e.g. en-US, en-GB, fr-FR',  // en-US
        defaultLanguage: 'same as locale',
        supportedLanguages: 'list of all supported language of given country',
        timeZone : 'timezone for the country',                        // America/Los_Angeles
        directionality : 'text directionality (ltr or rtl)',          // ltr
        unrecognizedUSUserOnIntlSite : 'boolean value if user from US ip on international site is unrecognized',
        siteId: 'site id of the country',                             // 0
        isoCurrencyCode: 'currency code for country',                 // USD
        siteDefaultIsoCurrencyCode: 'currency code for site',         // USD
        timeZoneStd: 'standard time zone code',                       // PST
        timeZoneSummer: 'summer time zone code, if different',        // PDT
        geoConfig: 'geo config object'
    }

```

Apps can use this information from request.

Once `@ebay/locale-ebay` is configured in middleware section of config.json, accessing commons' API is as easy as this.


```javascript
    app.get('/', function (req, res) {

        var locality = req.locality; //locality object
        ...
        ...

    }
```

### Geo subdomain support

As part of Geo expansion it is required to support special domains for search bots to index pages in required language while still serving from ebay.com base domain.

Examples:

* ru.ebay.com services Russian content
* ru-kz.ebay.com services Russian content for Kazakhstan 

In order to activate this experimental mode, one needs to add/modify the following section in application config.json file:

```json
 "locale-ebay": {
    "plans": {
        "geo": ["viaUserAgent", "viaUrl", "viaBean", "viaCookie", "countryByIp", "seoURL", "viaSiteInfo", "viaDefault", "geoByCountryCode"]
    }
}
```

### Non-geo, guest use-case, experimental

For non-geo guest user as of now default behavior excludes detecting user location by IP.
In order to activate this, you need to put the following configuration as part of application config.json file.

```json
"locale-ebay": {
        "plans": {
            "default": ["viaUserAgent", "viaUrl", "viaBean", "viaUserLocale", "userByIp", "viaSiteInfo", "viaDefault", "geoByCountryCode"]
        }
    }
```

When activate, the user physical location will be populated with country and zip code and this will be transfered to experience or other COS-standard service and can be read from end-user-context -> user-phisycal-location

In nodejs you can do this

```js
const userContext = req.ebay.getEndUserContext().getUserLocationContext();
console.log(userContext.country, userContext.zip);
```

### Support for 'accept-language' header, experimental

For GBH countries, such as CN, RU, MX ... it is possible to honor the 'accept-language' HTTP header, if present, and set the locale accordingly, provided the specified locale is one of the country's supported languages.

In order to activate this, you need to add the following configuration as part of the application's config.json file.

```json
"locale-ebay": {
        "accept-language": true
 }
```
