// Internal type definitions for @ebay/commons-ebay 4.0
// Definitions by: Timur Manyanov <https://github.corp.ebay.com/tmanyanov>
// Definitions: https://github.corp.ebay.com/TypeScript/types-ebay
// TypeScript Version: 3.0

import * as express from 'express';
import { AppContextType } from '@ebay/app-context-ebay';

export {};

interface CosHeaderType {
    buildHeader(): string;
}

type UserId = string;
type AccountId = string;

declare namespace userMixins {
    interface Common {
        hasUserId(): boolean;
        getUserId(): UserId | undefined | null;
        getOriginalUserId(): any;
        getBestUserId(): any;
        hasLevel1UserId(): boolean;
        getLevel1UserId(): any;
        getPresentationUserId(): UserId | undefined | null;
        getPersistentUserId(): any;
        getPersistentVisitorAccountId(): AccountId | undefined | null;
        isEmailVisitor(): boolean;
        getJSPersistentUserId(): UserId | undefined | null;
        getAccountId(): AccountId | undefined | null;
        getOriginalAccountId(): AccountId | undefined;
        getPersistentAccountId(): AccountId | undefined;
        isLoggedInAsGuest(): boolean;
    }

    interface Cookies extends Common {
        getCookie(cookieId : any): any;
        getLevel2UserIdUnstripped(): UserId | undefined | null;
        hasAdminUserId(userId? : UserId): boolean;
        getAdminUserId(userId? : UserId): UserId | undefined | null;
        hasGuestCookie(): boolean;
        hasLevel2UserId(): boolean;
        getLevel2UserId(): UserId | undefined | null;
        getUserIdSignIn(): UserId | undefined | null;
        getUserFirstName(): string | undefined | null;
        getLevel1ExtUserId(): UserId | undefined | null;
        getLevel1Checksum(): any;
        getSignInWelcomeUsed(): boolean;
        getLevel2PageType(): any;
        getSignInPrefFlags(): number;
    }

    interface Headers extends Common {
        getPublicUserId(): any;
        getPublicAccountId(): any;
    }
}

export interface SiteInfo {
    "marketplace-id": string;
    "locale-info": {
      country: string;
      variant: string;
      language: string;
    };
    "site-id": number;
    "user-preferences": {
      language: string;
      timeZone: string;
      country: string;
      timeZoneNameStd: string;
      timeZoneNameSummer: string;
    };
  }

export interface UserBandwidth {
    isLow(): boolean
    isLowMedium(): boolean
    isMediumHigh(): boolean
    isHigh(): boolean
}

export interface Edp {
    corrId: string;
    channel: 'WEB' | 'NATIVE';

    buildHeader(): string;
}

export interface LocationContextType extends CosHeaderType {
    getState(): string;
    setState(state: string): void;
    getCountry(): string
    setCountry(country: string): void;
    getZip(): string;
    setZip(zip: string): void
    getLatitude(): number;
    setLatitude(latitude: number): void;
    getLongitude(): number;
    setLongitude(longitude: number): void;
    validateOrDefault(): void
}

export type ContextualLocationContextType = LocationContextType;
export type UserPhysicalLocationContextType = LocationContextType;

export interface OriginalUserIdType extends CosHeaderType {
    userId: UserId;
    accountId: AccountId;
    recognized: boolean;
}

export interface UserIdType extends CosHeaderType {
    acctId: string;
    acctRole: string;
    acctName: string;
    loginId: string;
    loginName: string
}

interface EndUserContext extends CosHeaderType {
    getUserAgent(): string;
    isPiggybackedUser(): boolean;
    getIPAddress(): string;
    getID(): string;
    getIdentityProvider(): string;
    getDeviceId(): string;
    getUserAgentAcceptHeader(): string;
    getUserAgentAcceptEncodingHeader(): string;
    getUserAgentAcceptCharsetHeader(): string;
    getStartingPointURI(): string;
    getApplicationURL(): string;
    getClientHints(): {
        [propName: string]: string
    };
    isProxied(): boolean;
    getUserContextualLocation(): ContextualLocationContextType;
    getUserPhysicalLocation(): UserPhysicalLocationContextType;
    getOriginalUserIdContext(): OriginalUserIdType;
    getUserIdContext(): UserIdType;
    getReferer(): string;
    getXFF(): string;
    getGuessedUserId(): UserId | undefined | null;
    setGuessedUserId(guessedUserId: UserId, force: boolean): void;
    getGuessedUserIdLegacy(): UserId;
    setGuessedUserIdLegacy(userIdLegacy: UserId, force: boolean): void;
    getExpectSecureURL(): string | undefined | null;
    setExpectSecureURL(value: string): void;
    getDeviceIdType(): string | undefined | null;
    setDeviceIdType(value: string): void;
    getAdminUserId(): UserId | undefined | null;
    userPrefersDesktopExperience(): boolean;
}

export interface UserCulturalPrefContextType extends CosHeaderType {
    getTimezone(): string;
    getUnits(): string;
    getCurrency(): string;
    setTimezone(timezone: string): void;
    setUnits(units: string): void;
    setCurrency(currency: string): void;
}

export interface CRequestIdType extends CosHeaderType {
    getRequestId(): string;
    getCorrelationRequestId(): string;
    getNodeId(): string;
}

export interface CTrackingType extends CosHeaderType {
    isCacheRequest(): boolean;
    getGuid(): string;
    getCorrelationGuid(): string;
    getTrackingGuid(): string;
    getBestUserId(): UserId;
    getPageId(): string;
    getRoverMediaplex(): string;
    getPartnerId(): string;
    getCacheKey(): string;
    getCacheMode(): string;
    getCacheTTL(): number;
}

export interface HostResult {
    isInternal: boolean;
    hasUpdate: boolean;
}

interface Context {
    requestUrl: string;
    signInPageUrl: string;
    getRequest(): express.Request;
    getResponse(): express.Response;
    getEndUserContext(): EndUserContext;
    getEdp(): Edp;
    getUserCulturalPrefContext(): UserCulturalPrefContextType;
    getCorrelationRequestId(): CRequestIdType;
    getCorrelationTracking(): CTrackingType;
    getPartnerId(): number;
    getAreaId(): number;
    getCoBrandId(): number;
    getUserAgent(): string;
    isInternalHost(): HostResult;
    isInternalRequest(): boolean;
    isHostInNetwork(): boolean;
    getRlogId(): string;
    getRemoteAddr(): string;
    getClientIP(): string;
    isSecure(): boolean;
    getSiteId(): number;
    getMarketplaceId(): string;
    getTerritoryId(): string;
    getGuid(): string;
    getMachineTagCookie(): string | undefined | null;
    isCookieSupportedEnabled(): boolean;
    getPageId(): string;
    getPageName(): string;
    getPageNameFromRoute(req: express.Request): string;
    getExperienceService(): string;
    getAcceptLanguages(): string[];
    getSiteInfo(): SiteInfo;
    getServerName(): string;
    getLocale(): string;
    logger(name: string): any;
    getTrackingGuid(): string | undefined | null;
    getCorrelationGuid(): string | undefined | null;
    setCorrelationGuid(guid: string): void;
    setSojGuid(guid: string): void;
    setMerchSojGuid(guid: string): void;
    getMerchSojGuid(): string | undefined | null;
    getRoverMediaplex(): string | undefined | null;
    getGuidContext(req : express.Request): any;
    getUserBandwidth(): UserBandwidth | 0;
    getUserBandwidthToOrigin(): UserBandwidth | 0;

    outboundContext: any;
}

interface CustomContext extends Context {
    isService: boolean;
    getSojGuid(): string | undefined | null;
    getDCCorrelationGuid(): string | undefined | null;
}

interface WebContext extends CustomContext,
userMixins.Cookies {
    siteInfo : SiteInfo;
}

interface ServiceContext extends CustomContext,
userMixins.Headers {
    siteInfo : SiteInfo;
}

export interface EbayContext extends WebContext, ServiceContext {
    appContext : AppContextType;
    appMeta : any;
    expSvc? : {
        operation?: any;
        operationId?: any;
    };
}

export interface Csp {
    nonce: string;
}

export namespace AppContext {
    interface appContext extends AppContextType {
        init(options : any, callback : (err : Error | null, result? : any) => any): any;
    }
}

export function middleware(options? : any): express.RequestHandler;

declare module 'express-serve-static-core' {
    interface Request {
        ebay: EbayContext;
        csp?: Csp;
    }
}
