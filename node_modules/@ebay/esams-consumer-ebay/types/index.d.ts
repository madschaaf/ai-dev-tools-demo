import { X509Certificate } from 'crypto';

export interface Holder {
    channelName: string;
    version: number;
    label: number;

    getChannelName(): string;
    getVersion(): string;
    getLabel(): string;
}

export interface EKRHolder extends Holder {
    rotationPeriod: number;
    verifyPeriod: number;
    keyExpiryDate: number;

    setKeyExpiryDate(dateInMs: number): void;
    getKeyExpiryDate(): number;

    isEKR(): boolean;
    isCurrent(now?: number): boolean;
    isExpired(now?: number): boolean;
    isFromFuture(now?: number): boolean;

    getRotationPeriod(): number;
    setRotationPeriod(val: number): void;

    getVerifyPeriod(): number;
    setVerifyPeriod(val: number): void;

    isArtifactStillValid(): boolean;
}

export interface KeyPairHolder extends EKRHolder {
    privateKey: string;
    certificates: X509Certificate[];

    getPrivateKey(): string;
    getCertificates(): X509Certificate[];
}

export interface SecretKeyHolder extends EKRHolder {
    encodedSecretKey: string;
    algorithm: string;
    envelopeVersion: number;
    mode: string;
    padding: string;
    digest: string;

    enforceExpiration(): this;
}

export interface PatronusKeyPairHolder extends KeyPairHolder {
    envelopeVersion: number;
    keyId: string;
}

export interface NonKeyHolder extends Holder {
    nonKey: string;
}

export interface CertificateHolder extends EKRHolder {
    certificate: X509Certificate;
}

export interface NameService {
    getSecretKey(channelName: string, channelVersion?: number): Promise<SecretKeyHolder>;
    getSealSecretKey(channelName: string, channelVersion?: number): Promise<SecretKeyHolder>;
    getKeyPair(channelName: string, channelVersion?: number): Promise<PatronusKeyPairHolder | KeyPairHolder>;
    getCertificate(channelName: string, channelVersion?: number): Promise<CertificateHolder>;
    getNonKey(channelName: string, channelVersion?: number): Promise<NonKeyHolder>;
}

export function getNameService(): NameService;

export interface EsamsSecretKey {
    encodedSecretKey: string;
    algorithm: string;
    expiration: number;
    verifyPeriod?: number;
    rotationPeriod?: number;
    channelVersion?: number;
}

export interface EsamsNonKey {
    value: string;
    channelVersion: number;
}

export interface EsamsKeyPair {
    privateKey: string;
    privateKeyAlgorithm: string;

    publicKey: string;
    publicKeyAlgorithm: string;

    verifyPeriod?: number;
    rotationPeriod?: number;
    channelVersion?: number;
}

export interface EsamsCertificate {
    encodedCertifcate: string;
    algorithm: string;

    verifyPeriod?: number;
    rotationPeriod?: number;
    channelVersion?: number;

    certificate: X509Certificate;
}

export interface EsamsClient {
    getSecretKey(channelName: string, channelVersion?: number): Promise<EsamsSecretKey>;

    getNonKey(channelName: string, channelVersion?: number): Promise<EsamsNonKey>;

    getKeyPair(channelName: string, channelVersion?: number): Promise<EsamsKeyPair>;

    getCertificate(channelName: string, channelVersion?: number): Promise<EsamsCertificate>;
}

export function getEsamsConsumer(identityFile?: string, options?: any): EsamsClient;
