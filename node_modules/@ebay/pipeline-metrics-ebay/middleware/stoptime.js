'use strict';

const logger = require('@ebay/logging-inc').logger('@ebay/pipeline-metrics-ebay');
const apiCallsElapsedTime = require('../lib/prometheusUtil.js').gTransactionTime;
const _namespace_ = 'platform';

module.exports = function stoptime() {
    return function stopTime(req, res, next) {
        const elapsedTime = Date.now() - req.startTime;
        logger.info('Total elapsed time in millisecond : %dms', elapsedTime.toFixed(3));
        apiCallsElapsedTime.set({ method: res.req.method, status: res.statusCode, _namespace_: _namespace_ },
            elapsedTime);
        next();
    };
};
