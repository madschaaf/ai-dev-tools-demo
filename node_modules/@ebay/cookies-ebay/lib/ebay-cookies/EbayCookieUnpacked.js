'use strict';

var util = require('util'),
    EbayCookie = require('./EbayCookie');

function EbayCookieUnpacked(meta, rawCookie) {
    EbayCookie.apply(this, arguments);
    this._unpackedValue = null;
    this._autoRefresh = meta.autoRefresh;
    if (meta.autoRefresh) {
        // this may not be needed as during load it gets reset to false
        this._rawCookie.setModified(true);
    }
    this._unpackedCreationDate = Date.now();
}

util.inherits(EbayCookieUnpacked, EbayCookie);

var proto = EbayCookieUnpacked.prototype;

proto.afterDeserialize = function () {
    // make sure the cookie is autorefreshed 
    this._rawCookie.setModified(this._autoRefresh);
};

proto.setUnpackedValue = function (value) {
    this.deserialize();
    if (value !== this._unpackedValue) {
        this._unpackedValue = value;
        // Mark the underlying cookie as modified so that it will
        // be committed
        this._rawCookie.setModified(true);
    }
};

proto.getUnpackedValue = function () {
    this.deserialize();
    // Lazily deserialize the raw cookie if needed
    return this._unpackedValue;
};

proto.getUnpackedCreationDate = function () {
    return this._unpackedCreationDate;
};

proto.isValidated = function () {
    return true;
};


module.exports = EbayCookieUnpacked;