'use strict';

var EventEmitter = require('events').EventEmitter;


exports.injectServiceLoginRequest = function injectServiceLoginRequest(){
    var req = new EventEmitter();
    req.correlationId = 0xabcdef;
    req.headers = {
        'User-Agent' : 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.149 Safari/537.36'
    };
    req.url = '/';
    req.get = function () {};
    req.header = function () {};
    req.ebay = {};
    req.ebay.appContext = {};
    req.ebay.getAccountId = function () {
        if (req.test) {
            return req.test._accountid;
        }
        return '1211891306';
    };
    req.ebay.getLevel1UserId = function () {
        if (req.test) {
            return req.test._userid;
        }
        return 'benma1023';
    };
    return req;

};

exports.injectRequest = function injectRequest(options) {
    var req = new EventEmitter();
    req.correlationId = 0xabcdef;
    req.headers = {
        'User-Agent' : 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.149 Safari/537.36'
    };
    req.url = '/';
    req.get = function () {};
    req.header = function () {};
    req.ebay = {};
    req.ebay.appContext = {
        appName: options && options.appName
    };
    req.ebay.getPersistentAccountId = req.ebay.getAccountId = function () {
        if (req.test) {
            return req.test._accountid;
        }
        return '1211891306';
    };
    req.ebay.getJSPersistentUserId = req.ebay.getLevel1UserId = function () {
        if (req.test) {
            return req.test._userid;
        }
        return 'benma1023';
    };
    return req;
};

exports.injectResponse = function injectResponse(req) {
    var res = new EventEmitter();
    res.req = req || {};
    res.header = function () {};
    return res;
};

// var instrumentEbay = require('instrument-ebay');
// var m = require('module');
// var originalLoader = m._load;

// m._load = function(name, meta) {

//    if (name === 'instrument-ebay') {
// 	   console.log('Injecting instrument-ebay for require');
// 	   return instrumentEbay;
//    }
//    return originalLoader.apply(m, arguments);
// };
