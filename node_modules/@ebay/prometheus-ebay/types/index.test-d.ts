import { expectType } from 'tsd';
import {
    Metrics,
    MetricsData,
    platformMetrics,
    applicationMetrics,
    namespaces
} from '.';

const metricsFoo = new Metrics('foo');

metricsFoo.createGauge(
    'nodejs_http_status_code',
    'No. of HTTP Status Codes',
    ['status']
);

metricsFoo.createCounter(
    'nodejs_oom_error_count',
    'Total number of Out of Memory Errors'
);

metricsFoo.createGauge(
    'nodejs_no_workers',
    'Number of Nodejs Workers running',
    [],
    function () {}
);

metricsFoo.createHistogram(
    'http_server_requests_duration_ms',
    'Histogram duration of HTTP requests in ms',
    ['version', '_namespace_'],
    [1, 2, 3],
    true
);

metricsFoo.createCounter(
    'https_request_tls_version_total',
    'Client TLS version',
    ['version', '_namespace_'],
    false
);


metricsFoo.createCounter(
    'https_request_tls_version_total',
    'Client TLS version',
    ['version', '_namespace_'],
    false,
    function () {}
);


const sumMetrics = applicationMetrics.createSummary(
    'nodejs_summary_metrics', 'My Custom Metric', ['metric_name']);
sumMetrics.observe({ metric_name: 'name' }, 20);

expectType<Promise<{ contentType: string, metrics: string }>>(metricsFoo.readMetrics());
expectType<Promise<MetricsData>>(metricsFoo.readOpenMetrics());
expectType<Promise<MetricsData>>(metricsFoo.readPrometheusMetrics());
expectType<void>(metricsFoo.resetMetrics());
expectType<void>(metricsFoo.clearMetrics());