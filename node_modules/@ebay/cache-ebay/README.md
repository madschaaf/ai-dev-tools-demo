# @ebay/cache-ebay

This is a helper to allow building in-memory cache with async content fetching and expiration which is useful to hold session and secret keys.

## Installation

```bash
yarn add @ebay/cache-ebay
```

## Usage

```js
const patronus = require('@ebay/patronus-client-ebay');
const { ExpirableCache } = require('@ebay/cache-ebay');

// we need to provide key fetcher
const keyFetcher = key => {
    return new Promise((resolve, reject) => {
        patronus.getSymmetricKey(key, (err, keyValue) => {
            if (err) {
                return reject(err);
            }
            resolve(keyValue);
        });
    })
};

/*
    The key value is assumed to have a 'expiry' field in ISOString format. Example:
    {
        value: 'primary key value',
        expiry: '2022-02-01T03:45:35.920Z'
    }
*/

const cache = new ExpirableCache(keyFetcher);
// the key will be fetched when it is requested
const secret = await cache.get('/app/secret/key');
```
_Note_: 
* the value returned by fetcher should have an `expiry` property which is the time when token would expire 
* a soft expiration would be calculated as 1/4 of real expiry period, after which a hard expire would block the call till a new key is retrieved or error is returned
