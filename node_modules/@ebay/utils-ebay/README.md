# @ebay/utils-ebay

[![Build Status](https://go/-/nodejsci/job/nodejs/job/utils-ebay/job/master/badge/icon)](http://go/-/nodejsci/job/nodejs/job/utils-ebay/job/master/) [![Dependency Status](https://appvalidator.vip.qa.ebay.com/nodejs/utils-ebay.svg)](https://appvalidator.vip.qa.ebay.com/nodejs/utils-ebay)
[![Code Coverage](https://badgeme.vip.qa.ebay.com/badge/sonar/v0/coverage/utils-ebay)](http://sonar/dashboard/index?id=utils-ebay)


Small collection of Utility / Helper Methods attributed to Request , Response Flow

## Changelog

See   [CHANGELOG.MD](https://github.corp.ebay.com/nodejs/utils-ebay/blob/master/CHANGELOG.md#changelog)

# Installation

`yarn add @ebay/utils-ebay`

# Usage

```javascript
var utils = require('@ebay/utils-ebay');

/** Get Base Host by Request Url ***/

console.log(utils.getBaseHost('www.ebay.de')) /*** Will return ebay.de **/

```

# API

## Request API's
* **getRemoteAddr(req)**
    Returns Remote IP address of caller retreived from request headers `x-ebay-client-ip` or `x-forwarded-for` or `req.ip` and follows the following [descision logic](https://wiki.vip.corp.ebay.com/pages/viewpage.action?spaceKey=ARCH&title=ClientIP+Descision+Tree)

    ```javascript
    console.log(utils.getRemoteAddr(req)) /*** Will return client IP address e.g 127.0.0.1 **/

    ```
* **getClientIP(req)**
    Returns client IP address retreived from request headers `x-forwarded-for` or `req.ip`

    ```javascript
    console.log(utils.getClientIP(req)) /*** Will return client IP address e.g 127.0.0.1 **/

    ```    
* **isIPFromAkamaiHeader(req)**
    Reads client IP address from `x-ebay-akamai-9` and  validate if the IP is from Akamai header or not

    ```javascript
    console.log(utils.isIPFromAkamaiHeader(req)) /*** Will return true/false**/

    ```    
* **getServerName(req)**
    Returns Server Name e.g `localhost` or `127.0.0.1` retreived from request headers `host`
    ```javascript
    console.log(utils.getServerName(req)) /*** Will return server name e.g qa.ebay.com or localhost or 127.0.0.1 **/

    ```
* **getClientInfo(req, payload)**
    Returns clientInfo string that is expected as ClientInfo event in CAL for any url
    ```javascript
    console.log(utils.getClientInfo(req, req.path))
    /* Example: RemoteIP=1.1.1.1&Server=www.ebay.com&Script=/path&Encoding=encoding&Agent=some-user-agent&Referer=some-referer&ForwardedFor=1.1.1.1 */
    ```
* **parseClientTLSVersionHeader(req)**
    Parses client TLS version header `x-ebay-client-tls-version`

    ```javascript
    console.log(utils.parseClientTLSVersionHeader(req)) /*** { version, ip } **/

    ```
### GetBaseHost by Request URL :

This `function` returns the baseHost from the given url.

#### Example 1:

```javascript
console.log(utils.getBaseHost('www.ebay.de')) /*** Will return ebay.de **/

```

### Get PageNot Responding Url by Request URL :

This `function` returns the baseHost from the given url.

#### Example2 :

```javascript

var url = utils.getPageNotRespondingUrl('www.ebay.paradise.co.uk');
console.log(url); /** Will print url value : 'http://pages.ebay.paradise.co.uk/messages/page_not_responding.html' **/

```
