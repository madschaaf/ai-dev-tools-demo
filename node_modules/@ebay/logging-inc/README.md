# logging-inc
[![Build Status](https://go/-/nodejsci/job/nodejs/job/logging-inc/job/master/badge/icon)](https://go/-/nodejsci/job/nodejs/job/logging-inc/job/master/) [![Dependency Status](https://nodevalid-i3ey5.vip.lvs01.dev.ebayc3.com/nodejs/logging-inc.svg)](https://nodevalid-i3ey5.vip.lvs01.dev.ebayc3.com/nodejs/logging-inc)  [![Code Coverage](https://nodevalid-i3ey5.vip.lvs01.dev.ebayc3.com/coverage/nodejs/logging-inc)](http://sonar/dashboard/index?id=logging-inc)


The module provides a simple API to do CAL logging as well as console output if enabled.
It is based on [cal module](https://github.corp.ebay.com/nodejs/node-cal).

On top of CAL it allows to configure logging based on log levels.

## Changelog

See   [CHANGELOG.MD](https://github.corp.ebay.com/nodejs/logging-inc/blob/master/CHANGELOG.md#changelog)

Install
```bash
$ npm install --save logging-inc --registry https://npm.corp.ebay.com/
```

Usage
```javascript
var logger = require('@ebay/logging-inc').logger('myapp:viewitem');
```

## Configuration

Since the module is based on CAL, you might want to look at [CAL configuration](https://github.corp.ebay.com/nodejs/node-cal).
You can configure logger for specific log levels using '*' or regular expressions separated by commas.
The names used for configuring log levels can be parts of logger name. You can use complex name, like: myapp:viewitem:findItems and then use * to enable groups: info=myapp:*

```js
    "logging-inc": {
        "loglevel": {
            "warn": "*",    // log warn, error, fatal, trasnactions
            "info": "app1:item,app1:view", // log only for app1:item and app1:view
            "debug": "app1:item*"    // enable debug for loggers with name that starts with app1:item
        }
    }
```
The available log level options are below. The options override the options bellow (i.e. if info=* then all options below will also be equal to '*')
```
debug
info
warn
error
fatal
transaction
```
By default the logging is configured as "warn": "*".

### Configuration at runtime

The module allows to update log levels at runtime without deploying a new manifest with log level changes.

You need to use this url `/admin/v3console/UpdateConfigCategoryXml?id=nodejs.config.logging-inc.common&logging-inc___loglevel___debug=*`.
This will enable _debug_, _info_, _warn_ and _error_.

Once you are done with debugging, please switch off back to original log levels to avoid excessive logging and CPU load by running `/admin/v3console/UpdateConfigCategoryXml?id=nodejs.config.logging-inc.common&clear=true` and verify that the new levels are removed.

## API

* logger.debug([format, ]data1, data2, data3, ...)
The method creates debug event with type='Debug'
```javascript
logger.debug('Hello %s %s', 'John', 'Doe'); // Hello John Doe
// or
logger.debug('Hello', 'John', 'Doe'); // Hello John Doe
```

* logger.info([format, ]data1, data2, data3, ...)
The method creates info event with type='Info'
```javascript
logger.info('Hello %s %s', 'John', 'Doe'); // Hello John Doe
// or
logger.info('Hello', 'John', 'Doe'); // Hello John Doe
```

* logger.warn([[format, ]data1, data2, data3, ..., ]error)
The method creates warn event with type='Warn'
It will use 0 for CAL status field.
```javascript
logger.warn('Failed to read attribute "%s" from %s',
    'items', 'http://shopping.vip.ebay.com', new Error('Test error'));
// produces message='Failed to read attribute "items" from
//  http://shopping.vip.ebay.com to read attribute' with error and status=0
```

* logger.error([[format, ]data1, data2, data3, ..., ]error)
The method creates error event with type='Error'
It will use error.code or error.statusCode or 1 for CAL status field.
```javascript
logger.error('Failed to read attribute "%s" from %s', 'items',
    'http://shopping.vip.ebay.com', new Error('Test error'));
// produces message='Failed to read attribute "items"
//  from http://shopping.vip.ebay.com to read attribute' with error and status=1
// or
var error = new Error('Test error');
error.code = '404';
logger.error('Failed to read attribute "%s" from %s',
    'items', 'http://shopping.vip.ebay.com', error);
// will produce message='Failed to read attribute "items" from
//  http://shopping.vip.ebay.com to read attribute' with error and status=404
// or you can just log error
logger.error(new Error('Test error'));
// will produce message='Test error' with error and status=1
```

* logger.fatal([[format, ]data1, data2, data3, ..., ]error)
The method creates fatal event with type='Fatal'
It will use error.code or error.statusCode or 1 for CAL status field.
```javascript
logger.fatal('Failed to read attribute "%s" from %s', 'items',
    'http://shopping.vip.ebay.com', new Error('Test error'));
// produces message='Failed to read attribute "items"
//  from http://shopping.vip.ebay.com to read attribute' with error and status=1
// or
var error = new Error('Test error');
error.code = '404';
logger.fatal('Failed to read attribute "%s" from %s',
    'items', 'http://shopping.vip.ebay.com', error);
// Produces message='Failed to read attribute "items"
//  from http://shopping.vip.ebay.com to read attribute' with error and status=404
```

### Custom appenders API
#### module.configure(config)
The appender must export 'configure' method that will configure appender and return function that will consume log event.

```javascript
module.exports.configure = function configure(config) {
    return function consume(evt) {
        console.log(evt);
    }
}
```
