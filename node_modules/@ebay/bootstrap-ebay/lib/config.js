'use strict';

const maxHeaderSize = require('http').maxHeaderSize;
const modConfig = require('@ebay/module-config-inc');

// Lazy load config, but meanwhile read prod values and use them till config is loaded
const BootstrapConfig = {
    getConfig() {
        const configName = 'bootstrap-ebay';
        if (!this.config) {
            modConfig(__dirname, (err, config) => {
                config.on('change', () => {
                    this.config = config.get(configName);
                });
            });
        }
        this.config = this.config || require('../config/config.json')[configName];
        return this.config;
    },

    getMaxHeaderSize() {
        return maxHeaderSize;
    },

    getWarnHeaderSize() {
        return this.getConfig().headers['warn-size'];
    },

    getErrorHeaderSize() {
        // the error size may be adjusted to avoid error in CAL,
        // but not bigger than the real limit
        return Math.min(
            this.getMaxHeaderSize(),
            this.getConfig().headers['error-size']
        );
    }
};

module.exports = {
    BootstrapConfig
};
