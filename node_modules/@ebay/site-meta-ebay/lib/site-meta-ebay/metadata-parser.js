'use strict';
var countryData = require('country-data').countries;
var currencyData = require('country-data').currencies;

var entities = require('@ebay/site-meta-resources-ebay/resources/EbaySites.json').EbaySitesEntities;
var metadata = require('@ebay/site-meta-resources-ebay/resources/EbaySites_metadata.json').EbaySites;

module.exports.parse = function parse(registry) {
    Object.keys(metadata).forEach(function(key) {
        var eBaySiteEnum = metadata[key];
        eBaySiteEnum.value = entities[key];

        //Add Country Code, currency code & ISO code
        var country = countryData[key.substring(5)];
        if (country && country.currencies && country.currencies[0]) {
            eBaySiteEnum.currency = country.currencies[0];
            eBaySiteEnum.iso = parseInt(currencyData[eBaySiteEnum.currency].number);
        }

        registry.addSiteByName(eBaySiteEnum);
        registry.addCountries(entities);

    });
    registry.addCurrencies(currencyData.all);
};
