#service-errors-ebay 
[![Build Status](https://ebayci.qa.ebay.com/CI-Instance/buildStatus/icon?job=service-errors-ebay)](https://ebayci.qa.ebay.com/CI-Instance/job/service-errors-ebay) [![Dependency Status](https://nodevalid-i3ey5.vip.lvs01.dev.ebayc3.com/nodejs/service-errors-ebay.svg)](https://nodevalid-i3ey5.vip.lvs01.dev.ebayc3.com/nodejs/service-errors-ebay)  [![Code Coverage](https://nodevalid-i3ey5.vip.lvs01.dev.ebayc3.com/coverage/nodejs/service-errors-ebay)](http://sonar/dashboard/index?id=service-errors-ebay)

Module provides error handling for nodejs service stack

# Installation

```
npm install service-errors-ebay --save
```

# Usage
```javascript
var errors = require('@ebay/service-errors-ebay');
app.use(errors())
```

# Error throwing

The module formats an error emitted as part of express next(err) call whenever error is thrown and caught by error handler.

Example:
```javascript
const ono = require('ono');
(req, res, next) => {
    next(ono({
        statusCode: 503,
        message: 'Test error',
        parameters: [
            { key: 'key1', value: 'val1' },
            { key: 'key2', value: 'val2' }
        ]
    }));
}
```

If one needs to emit a list of errors or warnings, one must create them within controller and add them as part of json response building logic according to standard defined [here](https://github.corp.ebay.com/commerceos/cos-error-and-exceptions/blob/master/error-and-exception-handling.md)

Example:
```javascript
// use helper to format our error
const { formatError } = require('@ebay/service-errors-ebay');
async (req, res) => {
    const response = {};
    const errors = []; // collect tolerable errors/warnings
    try {
        response.data1 = await makeOneServiceCall1();
    }
    catch (err) {
        errors.push(formatError(err))
    }

    try {
        response.data2 = await makeOneServiceCall2();
    }
    catch (err) {
        errors.push(formatError(err))
    }

    response.data3 = 'I am still standing';

    if (errors.length) {
        response.errorMessage = {
            warnings: [errors]
        }
    }

    res.json(response);
}
```
