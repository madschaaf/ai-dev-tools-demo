const Assert = require('assert');
const { object } = require('../utils');
const { camelCaseKeys, filterKeys, getValue } = object;

describe('Object utilities', () => {
    describe('camelCaseKeys', () => {
        it('should convert an object with underscored keys to camel case', () => {
            const initial = {
                access_token: 'token',
                token_expires_in: 10000
            };
            const expected = {
                accessToken: 'token',
                tokenExpiresIn: 10000
            };
            Assert.deepEqual(
                camelCaseKeys(initial),
                expected
            );
        });
    });

    describe('filterKeys', () => {
        it('should return an object with the keys specified in an array', () => {
            const initial = {
                accessToken: 'token',
                expiry: 123,
                refreshToken: 'refresh'
            };
            const expected = {
                accessToken: 'token',
                refreshToken: 'refresh'
            };
            Assert.deepEqual(
                filterKeys(['accessToken', 'refreshToken'])(initial),
                expected
            );
        });
    });

    describe('getValue', () => {
        it('should return the specified field value from an object', () => {
            const obj = {
                'foo': {
                    'bar': {
                        'baz': 'FooBar'
                    },
                    'bizam': ''
                }
            };

            Assert.strictEqual(getValue(obj, 'foo.bar.baz'), 'FooBar');
            Assert.strictEqual(getValue(obj, 'foo.bizam'), null);
            Assert.strictEqual(getValue(obj, 'foo.booya'), null);
            Assert.strictEqual(getValue(obj, 'test'), null);
            Assert.strictEqual(getValue(obj, 'test.another'), null);
        });

        it('should return the default value', () => {
            const obj = {
                count: null
            };

            Assert.strictEqual(getValue(obj, 'count', 0), 0);

            const images = getValue(obj, 'images', []);
            Assert.equal(Array.isArray(images), true);
        });

        it('should handle 0 return values properly', () => {
            const obj = {
                value: 0
            };

            Assert.strictEqual(getValue(obj, 'value', -1), 0);
        });

        it('should return values using indexed paths', () => {
            const obj = {
                values: [
                    {
                        id: 0
                    },
                    {
                        id: 1
                    }
                ],
                other: [
                    {
                        foo: [
                            {
                                val: 111
                            },
                            {
                                val: 222
                            }
                        ]
                    }
                ]
            };

            Assert.strictEqual(getValue(obj, 'values.0.id', -1), 0);
            Assert.strictEqual(getValue(obj, 'values[1].id', -1), 1);
            Assert.strictEqual(getValue(obj, 'values[2].id', -1), -1);
            Assert.strictEqual(getValue(obj, 'other[0].foo[1].val'), 222);
        });
    });
});