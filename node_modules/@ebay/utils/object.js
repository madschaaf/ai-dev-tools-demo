const { toCamelCase } = require('./string');

/**
 * Converts an objects keys that have underscores to camel case
 *
 * @param {Object} originalObject   object to apply the camel case conversion
 * @returns {Object}                resulting object with camel cased keys
 */
const camelCaseKeys = (originalObject) => {
    const convertedObject = Object.keys(originalObject).reduce(
        (accumulator, key) => {
            accumulator[toCamelCase(key)] = originalObject[key];
            return accumulator;
        }, {}
    );

    return convertedObject;
};

/**
 * Filters keys from original object in a new resulting object
 *
 * @param {Object} originalObject       object to apply filter
 * @param {Array<string>} listOfKeys    keys to filter by
 * @returns {Object}                    resulting object from filter
 */
const filterKeys = listOfKeys => originalObject => {
    const filteredObject = listOfKeys.reduce((accumulator, key) => {
        accumulator[key] = originalObject[key];
        return accumulator;
    }, {});

    return filteredObject;
};

/**
 * Returns the value of a specified object property
 *
 * @param {Object} object - the object to evaluate for existing properties and values
 * @param {String} path - the object path the value desired
 * @param {any} defaultValue - if a value isn't present return this
 * @returns {any} the value of the specified object property
 */
const getValue = (obj, path, defaultValue = null) => {
    const properties = path.split('.').reduce((output, property) => {
        property.split(/\[([^}])\]/g).forEach(key => {
            if (key.length > 0) {
                output.push(key);
            }
        });
        return output;
    }, []);

    const result = properties.reduce((acc, property) => {
        if (acc) {
            if ((typeof acc[property] === 'string' && !acc[property].length)
                    || acc[property] === undefined
                    || acc[property] === null) {
                return null;
            }
            return acc[property];
        }
        return null;
    }, obj);

    return result === null ? defaultValue : result;
};

module.exports = {
    camelCaseKeys,
    filterKeys,
    getValue
};
