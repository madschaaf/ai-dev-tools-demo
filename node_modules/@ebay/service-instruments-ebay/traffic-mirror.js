'use strict';

const logger = require('@ebay/logging-inc').logger('service-instruments-ebay/traffic-mirror');

module.exports = function trafficMirror(pipe) {
    const req = pipe.context.app ? pipe.context.app.request : undefined;

    pipe.on('request', async (request, next) => {
        logger.info('traffic mirror handler', pipe.context.clientId);

        if (request['traffic-mirror'] !== false && req?.headers?.israptortrafficmirror) {
            request.headers = {
                ...request.headers,
                israptortrafficmirror: req.headers.israptortrafficmirror
            };
        }

        next();
    });
};
