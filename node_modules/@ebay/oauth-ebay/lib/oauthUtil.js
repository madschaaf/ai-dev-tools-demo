'use strict';

var crypto = require('crypto');

function getCookie(requestContext) {
    if (!requestContext) {
        return null;
    }
    var req = requestContext.request;
    if (req && req.headers && req.headers.cookie) {
        return req.headers.cookie;
    }
    return null;
}

function getScopeQuery(scopes) {
    scopes = Array.isArray(scopes) ? scopes : [scopes];
    return scopes.join(' ');
}

function getKey(appName, scopes, tokenType, jwt) {
    return appName + ':' + getScopeQuery(scopes) + ':' + tokenType + ':' + jwt;
}

function getHash(key) {
    var sha1 = crypto.createHash('sha1');
    sha1.update(key);
    var keyhash = sha1.digest('hex');
    return keyhash;
}

function getKeyHash(appName, scopes, tokenType, jwt = 'disabled') {
    var key = getKey(appName, scopes, tokenType, jwt);

    var hash = getHash(key);
    return hash;
}


module.exports = {
    getHash: getHash,
    getKeyHash: getKeyHash,
    getCookie: getCookie,
    getScopeQuery: getScopeQuery
};
