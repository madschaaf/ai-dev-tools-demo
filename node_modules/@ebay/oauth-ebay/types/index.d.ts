import * as express from 'express';

/**
 * Options for the OAuth middleware
 */
export interface OAuthOptions {
  /**
   * Enable/disable application token caching
   * @default true
   */
  cache?: boolean;
  /**
   * Cache expiration time in milliseconds
   * @default 3600000 (1 hour)
   */
  cacheExpirationTime?: number;
  /**
   * Other custom options
   */
  [key: string]: any;
}

export {};

/**
 * Express middleware for eBay OAuth integration
 * @param options Configuration options for the middleware
 */
export function oauth(options?: OAuthOptions): express.RequestHandler;

/**
 * Result object returned after a successful token request
 */
export interface TokenResult {
    /**
     * The OAuth token string value
     */
    value: string;
    
    /**
     * Token lifetime in seconds as returned from the OAuth server
     */
    expires_in: number;
    
    /**
     * Timestamp when the token will expire (milliseconds since epoch)
     */
    expiration: number;
    
    /**
     * Token type (e.g., "Application", "User", "Recognized User")
     */
    type: string;
}

/**
 * Options for getting application tokens
 */
export interface AppTokenOptions {
    /**
     * OAuth scopes to request for the token
     * Can be a single scope string or an array of scope strings
     * @example 'https://api.ebay.com/oauth/api_scope'
     * @example ['https://api.ebay.com/oauth/api_scope', 'https://api.ebay.com/oauth/api_scope/sell.inventory']
     */
    scopes?: string | string[];
    
    /**
     * Token type to request
     * @default 'Application'
     * @example 'Application', 'Hosted'
     */
    type?: string;
    
    /**
     * Whether to use JWT (JSON Web Token) format
     * @default false
     */
    jwt?: boolean;
    
    /**
     * Force a token refresh instead of using a cached token
     * @default false
     */
    refresh?: boolean;
}

export type TokenCallback = (error: Error, appTokenResult: TokenResult) => void;

export interface OAuthContext {
    getApplicationToken(options?: AppTokenOptions): Promise<TokenResult>;
    /**
     * @deprecated Use getApplicationToken instead.
     */
    getAppToken(appname: string, callback: TokenCallback): void;
    /**
     * @deprecated Use getApplicationToken instead.
     */
    getAppToken(appname: string, scopes: string | string[], callback: TokenCallback): void;
    /**
     * @deprecated Use getApplicationToken instead.
     */
    getAppToken(appname: string, scopes: string | string[], type: string, callback: TokenCallback): void;
    getPublicAppToken(widgetAppName: string, callback: TokenCallback): void;
    getPublicAppToken(widgetAppName: string, scopes: string | string[], callback: TokenCallback): void;
    getUserToken(appname: string, scopes: string | string[], callback: TokenCallback): void;
    getPublicUserToken(widgetAppToken: string, callback: TokenCallback): void;
    getPublicUserToken(widgetAppToken: string, scopes: string | string[], callback: TokenCallback): void;
    getRecognizedUserToken(callback: TokenCallback): void;
    getRecognizedUserToken(scopes: string | string[], callback: TokenCallback): void;
    getPublicRecognizedUserToken(widgetAppName: string, callback: TokenCallback): void;
    getPublicRecognizedUserToken(widgetAppName: string, scopes: string | string[], callback: TokenCallback): void;
    getUserTokenCommon(appname: string, callback: TokenCallback): void;
    getUserTokenCommon(appname: string, scopes: string | string[], callback: TokenCallback): void;
    getUserTokenCommon(appname: string, scopes: string | string[], type: string, callback: TokenCallback): void;
    getUserTokenCommon(appname: string, scopes: string | string[], type: string,
        isRecognizedUser: boolean, callback: TokenCallback): void;
    getUserTokenCommon(appname: string, scopes: string | string[], type: string,
        isRecognizedUser: boolean, options: any, callback: TokenCallback): void;
    isRecognizedUser(): boolean;
    isSignIn(): boolean;
}

declare module '@ebay/commons-ebay' {
    interface EbayContext {
        oauth: OAuthContext;
    }
}
