/// <reference types="@ebay/commons-ebay" />
import * as express from 'express';
import { Request, Response } from 'express';
import { expectType } from 'tsd';
import { oauth, OAuthContext } from '@ebay/oauth-ebay';

// Mock Request and Response using type assertion
import { EbayContext } from '@ebay/commons-ebay';

// Create a partial mock of req.ebay
const req = {} as Request;
(req as any).ebay = { oauth: {} as OAuthContext } as EbayContext;

// Test the OAuth middleware
const oauthMiddleware = oauth({});
expectType<express.RequestHandler>(oauthMiddleware);

// Test the OAuthContext
expectType<OAuthContext>(req.ebay.oauth);

// Test getApplicationToken function (recommended method)
const tokenPromise = req.ebay.oauth.getApplicationToken();
expectType<Promise<import('@ebay/oauth-ebay').TokenResult>>(tokenPromise);

const tokenPromiseWithOptions = req.ebay.oauth.getApplicationToken({
  scopes: ['https://api.ebay.com/public'],
  type: 'Hosted',
  jwt: true,
  refresh: false
});
expectType<Promise<import('@ebay/oauth-ebay').TokenResult>>(tokenPromiseWithOptions);

// Test legacy getAppToken functions
req.ebay.oauth.getAppToken('foo', (err, result) => {
  if (result) {
    expectType<number>(result.expiration);
    expectType<number>(result.expires_in);
    expectType<string>(result.type);
    expectType<string>(result.value);
  }
});

req.ebay.oauth.getAppToken('foo', 'https://api.ebay.com/', (err, result) => {});
req.ebay.oauth.getAppToken('foo', ['https://api.ebay.com/public'], (err, result) => {});
req.ebay.oauth.getAppToken('foo', ['https://api.ebay.com/public'], 'Hosted', (err, result) => {});
req.ebay.oauth.getUserToken('foo', ['https://api.ebay.com/public'], (err, result) => {});
req.ebay.oauth.getPublicAppToken('foo', (err, result) => {});
req.ebay.oauth.getPublicAppToken('foo', ['https://api.ebay.com/public'], (err, result) => {});
req.ebay.oauth.getPublicUserToken('foo', (err, result) => {});
req.ebay.oauth.getPublicUserToken('foo', ['https://api.ebay.com/public'], (err, result) => {});
req.ebay.oauth.getRecognizedUserToken((err, result) => {});
req.ebay.oauth.getRecognizedUserToken(['https://api.ebay.com/public'], (err, result) => {});
req.ebay.oauth.getPublicRecognizedUserToken('foo', (err, result) => {});
req.ebay.oauth.getPublicRecognizedUserToken('foo', ['https://api.ebay.com/public'], (err, result) => {});

// Test various getUserTokenCommon overloads
req.ebay.oauth.getUserTokenCommon('foo', (err, result) => {});
req.ebay.oauth.getUserTokenCommon('foo', ['https://api.ebay.com/public'], (err, result) => {});
req.ebay.oauth.getUserTokenCommon('foo', ['https://api.ebay.com/public'], 'Hosted', (err, result) => {});
req.ebay.oauth.getUserTokenCommon('foo', ['https://api.ebay.com/public'], 'Hosted', true, (err, result) => {});
req.ebay.oauth.getUserTokenCommon('foo', ['https://api.ebay.com/public'], 'Hosted', true, {}, (err, result) => {});

// Test boolean methods
expectType<boolean>(req.ebay.oauth.isRecognizedUser());
expectType<boolean>(req.ebay.oauth.isSignIn());
