'use strict';

var utils = require('../lib/utils');
var logger = require('@ebay/logging-inc').logger('tracking-ebay:tracking');
module.exports = {
    render: function (input, context) {
        var req = context.stream && context.stream.req;
        if (!req) {
            req = context.global &&  context.global.req;
        }
        var _tracking = req.ebay.tracking;
        if (!_tracking.getTaasContext) {
            logger.warn('Failed to render tracking-image helper, tracking is not available');
            return;
        }
        var asyncContext = context.beginAsync();
        _tracking.getTaasContext(function (err, taasContext) {

            if (err) {
                logger.error('tracking async fragment failed: ', err);
            } else {
                utils.renderInlineTrackingCode(asyncContext,
                    taasContext,
                    _tracking.expSvcImpression);
            }
            asyncContext.end();
        });
    }
};
