import { expectType, expectAssignable } from 'tsd';
import { TrackingContext, middleware, warmup, renderInlineTrackingCode, updateCookies, PulsarEventTracker } from '.';
import { Request, Response } from 'express';
import '@ebay/commons-ebay';

declare global {
    namespace Express {
        interface Request {
            ebay: {
                tracking: TrackingContext;
            };
        }
    }
}

// Mock Request and Response objects
const req = {} as Request;
const res = {} as Response;

// Start writing your tsd tests based on the dtslint expectations

// $ExpectType TrackingContext
expectType<TrackingContext>(req.ebay.tracking);

// $ExpectType void
req.ebay.tracking.trackModuleImpression(9999);

// $ExpectType void
req.ebay.tracking.trackTag('ddm', '1');

// $ExpectType void
req.ebay.tracking.trackVectorTag('ddm', '1');

// $ExpectType void
req.ebay.tracking.trackVectorTag('ddm', ['1', '2']);

// $ExpectType void
req.ebay.tracking.trackFlag(1);

// $ExpectType any
expectAssignable<any>(req.ebay.tracking.addTrackingHeadersForRequest({}));

// $ExpectType void
req.ebay.tracking.handleResponseHeaders(res.getHeaders());

// $ExpectType PulsarEventTracker
expectAssignable<PulsarEventTracker>(req.ebay.tracking.getRequestScopeTracker());

const tracker = req.ebay.tracking.getRequestScopeTracker();
tracker.setEventType('TOPN', 'TSA', '1.0');
tracker.addData('rmaqe', 37);
tracker.addData('kwd', 'nike');
tracker.addData('prdi', 1234);

const itemsList = [10, 20, 30];
tracker.addData('itms', itemsList);
tracker.setEventFlag(0, true);

// $ExpectType void
renderInlineTrackingCode(req.ebay.tracking, {}, 123);

// $ExpectType boolean
expectType<boolean>(updateCookies(req, res, {}));

// $ExpectType (req: Request, res: Response, next: any) => any
expectType<(req: Request, res: Response, next: any) => any>(middleware({}));

// $ExpectType any
expectAssignable<any>(warmup());
