# ChangeLog
## v4.16.1
* NODE-5341: Changed log type from Error to Warn to avoid BCD failures

## v4.13.2
* tracking-ebay: add propagation of serviceCorrelationId in x-ebay-c-correlation-session header
* similar to raptor and raptor-io ginger propagator.

## v4.12.2
* tracking-ebay: remove trackingentityservice as it is not longer available

## v5.0.0-xs-rc.5
* Rebase with master to xs-release, branch experience-service-rebase10 to pick up v4.12.0 and v4.12.1 changes

## v4.12.1
* Fix: tracking NPE after switch to pulsar metadata, https://jirap.corp.ebay.com/browse/NODE-3843

## v4.12.0
* Trk 18483 - switch to pmsvc service

## v5.0.0-xs-rc.4
* Rebase with master to xs-release, branch experience-service-rebase9 (created of master)

## v5.0.0-xs-rc.3
* Rebase with master, branch experience-service-rebase8

## v5.0.0-xs-rc.2
* Scope migration and rebase with main

## v5.0.0-xs-rc.1
* Added tracking into response body for service use-case as well as response header for non-experience use-case when pulsar is not used

## v4.11.1
* Fix: tracking should disable tracking ciid comes with operationId, https://jirap.corp.ebay.com/browse/NODE-3748

## v4.11.0
* Typescript support for tracking-ebay module, https://jirap.corp.ebay.com/browse/NODE-3644

## v4.10.1
* Fix: worker restart due to invalid X-EBAY-C-CORRELATION-SESSION, https://jirap.corp.ebay.com/browse/NODE-3605
## v4.10.0
* Increase the number of tags to load and split into 2 batches, issue: Cannot drop new SOJ tags in Node.js apps, https://jirap.corp.ebay.com/browse/NODE-3502

## v4.9.0
* Added outbound-context instrument to trk20svc per https://jirap.corp.ebay.com/browse/NODE-3497

## v4.8.0
* Bot-detector - new solution - using hardcoded TEV data, so TEV service not called (since TEV going to be deleted)

## v4.7.3
* Reverted the changes related to removal ot TEV service and bot logic till we fix bot-handler-ebay headers logic to handle non-bot headers

## v4.7.2
* Moved bot tracking from bot-handler-ebay module, https://jirap.corp.ebay.com/browse/NODE-3384
## v4.7.0
* Added hrc tag logging
* Removed TEV functionality since TEV going to be decommissioned. Replaced with req.ebay.bot

## v4.5.5
* Added fixes & tests to handle soj.u = 'undefined'

## v4.5.3
* Fixed: remove the user of blacklisted cookies (lucky9, reg), https://jirap.corp.ebay.com/browse/NODE-3136
## v4.5.2
* Fix: UserAcquisition call at Signin for returning users missing operationId, https://jirap.corp.ebay.com/browse/NODE-2842

## v4.5.1
* Fixed: expose option to switch to pulsar from rover, https://jirap.corp.ebay.com/browse/NODE-2822

## v4.5.0
* Upgraded to marko 3/4 by switching to tracking-marko-ebay module for the tags
* Upgraded to lasso unit tests
* Other dependency upgrades

## v4.4.0
* shot vip to long vip switch

## v4.3.1
* Moved commons-ebay to dev dependencies

## v4.3.0
* Webview changes

## v4.1.8
* Support for Lasso@3

## v4.1.7
* Fixed: corrid is 0 when published to pathfinder

## v4.1.6
* Implemented: passing operationId to userAcquisition call in Node(Not working on few pages), https://jirap.corp.ebay.com/browse/NODE-2360

## v4.1.5
* Cguid validation should be added, https://jirap.corp.ebay.com/browse/NODE-2033

## v4.1.4
* Removed explicitly defined discovery instrument

## v4.1.3
* Added urn for service-discovery

## v4.1.2
* Fixed: Missing value for requestid & correlationId tags, https://jirap.corp.ebay.com/browse/NODE-2027

## v4.1.1
* Fixed: should not log entire context whenever 4 mandatory tags are invalid or missing, https://jirap.corp.ebay.com/browse/NODE-1986

## v4.1.0
* Fixed: NodeJS Tracking Module: guid validation should be added, https://jirap.corp.ebay.com/browse/NODE-1986

## v4.0.20
* Fixed: Service should correctly handle ciid for XS and module provider, https://jirap.corp.ebay.com/browse/NODE-1983

## v4.0.24
* Added X-EBAY-C-TRACKING header propagation to get taas context as well as taas js injection for dynamic si attribute for client side X_EBAY_C_CORRELATION_SESSION object.

## v4.0.22
* Reverted 4.0.21, but did not revert the code changes, waiting for the follow up PR

## v4.0.21
* Support defer scripts

## v4.0.20
* Fixed: Service should correctly handle ciid for XS and module provider, https://jirap.corp.ebay.com/browse/NODE-1983

## v4.0.19
* Fixed: SID tacking tag not dropping during redirection
https://jirap.corp.ebay.com/browse/NODE-1599

## v4.0.18
* Fixed RDT tag logging for 302 (Contributed by Anton Ganeshalingam)

## v4.0.17
* Support RDT tag for 302 redirect (Contributed by Rababah, Abdullah)

## v4.0.16
* Added brotli support
https://jirap.corp.ebay.com/browse/NODE-1682
https://jirap.corp.ebay.com/browse/NODE-1689

## v4.0.15
* Fixed: Should send `TDuration` to Pathfinder
https://jirap.corp.ebay.com/browse/NODE-1636

## v4.0.14
* Fixed: Should send correct values for Server & Script.
https://jirap.corp.ebay.com/browse/NODE-1597

## v4.0.13
* XSS fix related to _trkpsid

## v4.0.12
* Read req from tracking.req for async-fragment

## v4.0.11
* Fixed: should propagate x-ebay-c-correlation-session from header over cookies, https://jirap.corp.ebay.com/browse/NODE-1534

## v4.0.10
* Added defensive logic to prevent failures when req is missing in the context due to various reasons.
* Fixed some unit tests for taas javascript link as it has changed recently

## v4.0.9
* Added IP address fallback to use RemoteIP when XFF header is missing
* Added tracking session info to be used on client side, https://jirap.corp.ebay.com/browse/NODE-1503
* Added `ids` to tracking Script, Img tags for Caching to find on UFES
https://wiki.vip.corp.ebay.com/display/TRACKING/TAAS+Integration
https://jirap.corp.ebay.com/browse/NODE-1354
* Added: Sending X-EBAY-C-TRACKING headers to Pulsar tracking service

## v4.0.8
* Added missing gci to the pulsar request context, https://jirap.corp.ebay.com/browse/NODE-1311

## v4.0.7
* Disabled SOJ logging to CAL as Pathfinder is 100% enabled

## v4.0.6
* Fixed: Uncaught error when tracking tags get invalid unicode characters, https://jirap.corp.ebay.com/browse/NODE-1306
* CIID needs to be attached to pulsar tracking when it is done in nodejs, https://jirap.corp.ebay.com/browse/NODE-1134

## v4.0.5
* Bumped pathfinder-ebay to 5.0 and adjust API

## v4.0.2
* Added XFF headers to send to Pathfinder

## v4.0.1
* Update ebaytrackingservice to retry once on failure

## v4.0.0
* Remove peer and unwanted dependencies and upgrade dependencies
* Added operationId to X-EBAY-C-CORRELATION-SESSION per https://jirap.corp.ebay.com/browse/NODE-820

## 0.3.60
* Make bot detection case insensitive

## 0.3.59
* TPayload should encode all values; removed agent from TPayload as it should not be there.
* Migrated from servicecore to service-client-ebay@^2

## 0.3.59
* Added operationId to X-EBAY-C-CORRELATION-SESSION per https://jirap.corp.ebay.com/browse/NODE-820
* Pathfinder should not log SOJ events when experience service does it, similar to CAL soj writer
* Removed `isSecure` for masking query params, switched to config based list
* Updated tests for `getMaskPayload`

## 0.3.58
* Added masking of query params for secure env

## 0.3.57
* Fix for NODE-784 : Moved `writeToCal` call to before `writeToPathfinder` for fixing redirection issue

## 0.3.56
* Fixed JIRA https://jirap.corp.ebay.com/browse/NODE-792 for missing parameters/double encoding
* Fixed JIRA https://jirap.corp.ebay.com/browse/NODE-793 for PageName
* Changed `socketTimeout` & `markdown-threshold` to correct keys

## 0.3.55
* Fixed JIRA https://jirap.corp.ebay.com/browse/NODE-785 for URL encoding some parameters

## 0.3.54
* Added additional fields to Pathfinder service

## 0.3.53
* Added `csp` `nonce` support for tracking script tags

## 0.3.52
* Added `pathfinder` service call for logging SOJ events

## 0.3.51
* Fixed: Should not crash when setContextFlag('name', false) is used to set to false - https://github.corp.ebay.com/nodejs/tracking-ebay/issues/90

## 0.3.50
* Fixed: Should not Override `_trksid` if not in request.

## 0.3.49
* Fixed: https://jirap.corp.ebay.com/browse/NODE-344
Production exceptions -	getClientTrackingCtx_ServerError -"exceptionId: 'sid request param is required".


## 0.3.48
* Fixed: Should execute tracking on response.end only once, https://github.corp.ebay.com/nodejs/tracking-ebay/issues/80
* Fixed: Use the error message from service response (for example when tracking DB connection is marked down.)

## 0.3.47
* Fixed: tracking tags cannot find request object when used within async fragment

## 0.3.46
* Export two functions needed by separate tracking-marko-ebay package

## 0.3.45
* Remove quotes around true for soj log on page

## 0.3.44
* Removed unused dependencies

## 0.3.43
* Temp workaround: when sojguid cookies is set and then used by taas to get context. This results in two tracking images dropped to the page. The workaround is to pick only roverns url in such a case - https://jirap.corp.ebay.com/browse/NODE-236
* Fixed: _trkparam to _trkparms
* Fixed: should not invoke getTEVList more than once at a time due to race conditions
* Fixed: sid in X-EBAY-C-CORRELATION-SESSION should be decoded into pcml
* Fixed: si in X-EBAY-C-CORRELATION-SESSION should be dc correlation guid
* Changed: getTaasContext should use nodeJS profile for all requests
* Added: trkp params should be tracking as part of X-EBAY-C-CORRELATION-SESSION from req.query._trkparam or req.body._trkparam
* Added: trk-gflgs should be tracked as part of X-EBAY-C-CORRELATION-SESSION
* Added: sid and trkp will be forwarded if there is a call to ExpSvc/ModuleProvider from nodeJS.
* Added: if there is a ciid in ExpSvc response tracking header, do not log impression on nodeJS.
* Fixed: NodeJS: guid(si) and cguid(gci) values are getting swapped in Tracking 2.0 header (X-EBAY-C-CORRELATION-SESSION) - https://jirap.corp.ebay.com/browse/NODE-242
* Fixed: NodeJS: SOJ k is getting logged in CAL at Node.js side when EXP. Svc when returns ciid in Tracking response header - https://jirap.corp.ebay.com/browse/NODE-243
* Fixed: NodeJS: trk-gflgs and cflags are not showing up - https://jirap.corp.ebay.com/browse/NODE-244
* Fixed: NodeJS: not passing "trkp" in Tracking 2.0 Header to Exp. Svc. for certain cases https://jirap.corp.ebay.com/browse/NODE-245

## 0.3.42
* Perf: should not have on-line require.

## 0.3.41
* Fixed :
1. *Error* `operationId` was logged incorrectly to Sojourner
2. Enabled **pulsarJS** for TAAS when the experience Service is invoked.

## 0.3.40
* removed request-local from peerDependencies (published from 0.3.39)

## 0.3.39
* Performance: page tracking info should be disabled by default on staging, lnp

## 0.3.38
* Fixed: removeDuplicates should not decode value.

## 0.3.37
* Temporary disabled new framework id in taas/helper.js from nodeJS back to raptor till tracking experience service support is ready.

## 0.3.36
* Fixed: should escape soj tracking tags (https://github.corp.ebay.com/nodejs/tracking-ebay/issues/37)

## 0.3.35
* Fixed: should pick up new metadata (tags, flags, modules) from remote service https://jirap.corp.ebay.com/browse/NODE-97
* Disabled rover unit test temporary
* Changed endpoints to QA as prod is no longer available

## v0.3.34
* Enhancement: Added instrumentation info for Response End and Flush of `SOJ A & K Events`

## v0.3.33
* Fixed: Removed validation of not found `moduleids`
* Fixed: Update Cookies exception crashing the process.

## v0.3.32
* Fixed: Resources `modules` w/preloaded Attributes

## v0.3.31
* Fixed: Set to log error when maximum vector data is reached.

## v0.3.30
* Removed small timeout for development to avoid botloader refresh too frequently.
* Made botloader refresh via setImmediate to avoid sticking to transaction.
* Fail postinstall if any error happen.
* Refactored environment setup in unit tests.
* Fixed CI build - updated QA endpoint for pulsar

## v0.3.29
* Fixed: should dedupe soj tracking data

## v0.3.28
* Fixed: NPE when setting tracking to response, service flow.

## v0.3.27
* fixed: server side tags should not break browser if used in the component used on service and client side.

## v0.3.26
* fixed pulsar metadata preload and caching

## v0.3.25
* fixed NPE when soj data from service is empty

## v0.3.24
* Added support for nodejs services.
* Split Tracking context into service context and web context accessible at req.ebay.tracking
