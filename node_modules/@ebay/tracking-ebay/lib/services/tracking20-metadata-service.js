'use strict';

var Assert = require('assert');
var provider = require('@ebay/service-client-ebay');

/** Nock tet case to invoke and parse serive reponse */
module.exports = {

    /**
     * getResourceInstancesByType has been deprecated by Java Pulsar implementation
     */
    getResourceInstancesByType(options, callback) {
        Assert.ok(options && options.resourceTypeName, 'Should provide resource type name');

        provider.context({}).getClient('tracking20metadataservice')
            .request(options)
            .path('/resourceInstance/findByStatus/' + options.resourceTypeName + '/1')
            .end(function handleResponse(err, res) {
                if (!err && res && res.body && res.body.ackValue !== 'SUCCESS' && res.body.errorMessage) {
                    err = new Error(JSON.stringify(res.body.errorMessage));
                }
                callback(err, res);
            });
    },

    getResourceInstancesByEventType(callback) {
        provider.context({}).getClient('tracking20metadataservice')
            .request({})
            .path('/pmsvcCache/getEventTypeCache')
            .end(function handleResponse(err, res) {
                if (!err && res && res.body && res.body.ackValue !== 'SUCCESS' && res.body.errorMessage) {
                    err = new Error(JSON.stringify(res.body.errorMessage));
                }

                callback(err, res);
            });
    }
};