import { expectType, expectAssignable } from "tsd";
import LegacyPatronusClient, {
  PatronusClient,
} from "@ebay/patronus-client-ebay";

expectType<void>(
  LegacyPatronusClient.getAsymmetricKeyPair(
    "path.to.key",
    (err, response) => {}
  )
);
expectType<void>(
  LegacyPatronusClient.getSymmetricKey("path.to.key", (err, response) => {})
);
expectType<void>(
  LegacyPatronusClient.getEsamsSymmetricKey(
    "channel.name",
    1,
    (err, response) => {}
  )
);
expectType<void>(
  LegacyPatronusClient.getEsamsKeyPair("channel.name", 1, (err, response) => {})
);

const client = new PatronusClient();

type Usages = "ALL" | "ENCRYPT" | "SIGN";
type KeyPermissions =
  | "KeyWrite"
  | "KeyRead"
  | "KeyImport"
  | "KeyExport"
  | "KeyRevoke"
  | "KeyAll"
  | "CryptoEncrypt"
  | "CryptoDecrypt"
  | "CryptoSign"
  | "CryptoVerify"
  | "CryptoSeal"
  | "CryptoUnseal"
  | "CryptoAll"
  | "AclRead"
  | "AclWrite";

type BaseKey = {
  id: string;
  name: string;
  application: string;
  createdBy: string;
  createTime: string; // This is a date string e.g. 2025-07-02T23:59:00.000Z
  updatedBy: string;
  updateTime: string; // This is a date string e.g. 2025-07-02T23:59:00.000Z
  version: number;
  format: "RAW" | "PKCS8" | "PGP" | "GPG" | "SSH";
  state: "ACTIVE" | "DEACTIVATED";
  algorithm: string;
  digest: string;
  size: number;
  mode: string;
  padding: string;
  authTagLen: string;
  exportable: boolean;
  autoRotate: boolean;
  expiry: string; // This is a date string e.g. 2025-07-02T23:59:00.000Z
  usages: Usages[];
  material: string; // Base64 encoded key material. Private key material if the key type is asymmetric
  path: string;
  parent: string;
  nodeType: "KEY";
  permissions: {
    application: string;
    allow: KeyPermissions[];
    deny: KeyPermissions[];
  }[];
  metadata: Record<string, string>;
  type: "ASYMMETRIC" | "SYMMETRIC";
  publicKey?: string;
}

type AsymmetricKey = BaseKey & {
  type: "ASYMMETRIC";
  publicKey: string;
}

type SymmetricKey = BaseKey & {
  type: "SYMMETRIC";
}

(async () => {
  expectAssignable<AsymmetricKey | SymmetricKey>(await client.getPatronusKey("path.to.key"));
  expectAssignable<AsymmetricKey>(await client.getAsymmetricKey("path.to.key"));
  expectType<string>(
    await client.getPatronusKeyByIssuerAndSerialNumber("issuer", "serialNumber")
  );
})();
expectType<boolean>(client.isEnabled());
