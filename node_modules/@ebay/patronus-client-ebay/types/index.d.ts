import { ResponseData } from "@ebay/service-client-ebay";

export type ResponseCallback = (err: Error, response: ResponseData) => void;

declare class LegacyPatronusClient {
  getAsymmetricKeyPair(
    keyPathOrKeyId: string,
    callback: ResponseCallback
  ): void;
  getSymmetricKey(keyPathOrKeyId: string, callback: ResponseCallback): void;
  getEsamsSymmetricKey(
    channelName: string,
    version: number,
    callback: ResponseCallback
  ): void;
  getEsamsKeyPair(
    channelName: string,
    version: number,
    callback: ResponseCallback
  ): void;
}

declare const _LegacyPatronusClient: LegacyPatronusClient;
export default _LegacyPatronusClient;

export type Usages = "ALL" | "ENCRYPT" | "SIGN";
export type KeyPermissions =
  | "KeyWrite"
  | "KeyRead"
  | "KeyImport"
  | "KeyExport"
  | "KeyRevoke"
  | "KeyAll"
  | "CryptoEncrypt"
  | "CryptoDecrypt"
  | "CryptoSign"
  | "CryptoVerify"
  | "CryptoSeal"
  | "CryptoUnseal"
  | "CryptoAll"
  | "AclRead"
  | "AclWrite";

// As defined in OpenAPI spec
// https://pages.github.corp.ebay.com/security-platform/patronus-docs/#/Key/get_keys__key_path__export
interface BaseKey {
  id: string;
  name: string;
  application: string;
  createdBy: string;
  createTime: string; // This is a date string e.g. 2025-07-02T23:59:00.000Z
  updatedBy: string;
  updateTime: string; // This is a date string e.g. 2025-07-02T23:59:00.000Z
  version: number;
  format: "RAW" | "PKCS8" | "PGP" | "GPG" | "SSH";
  state: "ACTIVE" | "DEACTIVATED";
  algorithm: string;
  digest: string;
  size: number;
  mode: string;
  padding: string;
  authTagLen: string;
  exportable: boolean;
  autoRotate: boolean;
  expiry: string; // This is a date string e.g. 2025-07-02T23:59:00.000Z
  usages: Usages[];
  material: string; // Base64 encoded key material. Private key material if the key type is asymmetric
  path: string;
  parent: string;
  nodeType: "KEY";
  permissions: {
    application: string;
    allow: KeyPermissions[];
    deny: KeyPermissions[];
  }[];
  metadata: Record<string, string>;
}

export interface SymmetricKey extends BaseKey {
  type: "SYMMETRIC";
}

export interface AsymmetricKey extends BaseKey {
  type: "ASYMMETRIC";
  publicKey: string;
}
export class PatronusClient {
  getPatronusKey(
    channelName: string,
    version?: number
  ): Promise<SymmetricKey | AsymmetricKey>;
  getAsymmetricKey(
    channelName: string,
    version?: number
  ): Promise<AsymmetricKey>;
  getPatronusKeyByIssuerAndSerialNumber(
    issuer: string,
    serialNumber: string
  ): Promise<string>;
  isEnabled(): boolean;
}
