# trust-fabric-ebay

[![Build Status](https://go/-/nodejsci/job/nodejs/job/trust-fabric-ebay/job/master/badge/icon)](https://go/-/nodejsci/job/nodejs/job/trust-fabric-ebay/job/master) [![Dependency Status](https://appvalidator.vip.qa.ebay.com/nodejs/trust-fabric-ebay.svg)](https://appvalidator.vip.qa.ebay.com/nodejs/trust-fabric-ebay)
[![Code Coverage](https://badgeme.vip.qa.ebay.com/badge/sonar/v0/coverage/trust-fabric-ebay)](http://sonar/dashboard/index?id=trust-fabric-ebay)


`@ebay/trust-fabric-ebay` is Node.js client for generating TrustFabric tokens for calling Fidelius(secrets).
TrustFabric runs background timer and updates token when token expires.

If the background timer faces an error while updating the token, it re-schedules itself according to milliseconds specified in config property named `refreshFailRetry`. 

## Changelog

See [CHANGELOG.MD](https://github.corp.ebay.com/nodejs/trust-fabric-ebay/blob/master/CHANGELOG.md#changelog)

## Installation

`npm install @ebay/trust-fabric-ebay --save`

## Usage

```javascript
    var trustFabric = require('@ebay/trust-fabric-ebay');
```

## Configuration

In case of nodejs service application you can enable trust-fabric header validation by adding this config to your app/config/config.json
```json
"trust-fabric-ebay": {        
    "interceptHeaders": {
        "mode": "enforcement"
    }
}
```

## API

### getToken(callback)
* **callback(error, token)**: Callback will be called with the token and returns error when token cannot be generated.

```javascript
    var trustFabric = require('@ebay/trust-fabric-ebay');

    trustFabric.getToken((error, token) => {
        console.log(token);
    });
```

### TrustFabric Token with Scopes

Now TrustFabric Client supports Scopes, default token doesn't have scope. TokenGenerator should be created explicity.

```javascript
    
    // Array of Scopes
    const options = {
        scopes: ['scope1', 'scope2']
    };
    const trustFabricWithScope = new TokenGenerator(options);

    trustFabricWithScope.getToken((error, token) => {
        console.log(token);
    });
```

